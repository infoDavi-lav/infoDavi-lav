=== Estratti codice (Console RPG C++) ===

[1] Conta caratteri visibili ignorando ANSI (file esempio/main.cpp)
// Mantiene l'allineamento dei box anche con colori
static size_t visibleLen(const std::string& s) {
    size_t vis = 0;
    for (size_t i = 0; i < s.size();) {
        unsigned char c = static_cast<unsigned char>(s[i]);
        if (c == 0x1B && i + 1 < s.size() && s[i + 1] == '[') {
            size_t j = i + 2;
            while (j < s.size() && s[j] != 'm') j++;
            if (j < s.size()) j++;
            i = j;
        } else { ++vis; ++i; }
    }
    return vis;
}

[2] Tronca stringhe colorate senza bleed (file esempio/main.cpp)
// Ferma alla lunghezza visibile richiesta e chiude i colori
static std::string truncateVisible(const std::string& s, size_t maxVis) {
    if (visibleLen(s) <= maxVis) return s;
    std::string out; size_t vis = 0;
    for (size_t i = 0; i < s.size() && vis < maxVis;) {
        unsigned char c = static_cast<unsigned char>(s[i]);
        if (c == 0x1B && i + 1 < s.size() && s[i + 1] == '[') {
            size_t j = i + 2;
            while (j < s.size() && s[j] != 'm') j++;
            if (j < s.size()) j++;
            out.append(s, i, j - i);
            i = j;
        } else {
            out.push_back(s[i]); ++i; ++vis;
        }
    }
    out += ansi::reset;
    return out;
}

[3] Box di testo con padding corretto (file esempio/main.cpp)
// Usa le funzioni sopra per allineare i bordi
static void boxLine(const std::string& text) {
    std::string s = text;
    size_t maxVis = UI_WIDTH - 2;
    if (visibleLen(s) > maxVis) s = truncateVisible(s, maxVis);
    size_t pad = (maxVis > visibleLen(s)) ? (maxVis - visibleLen(s)) : 0;
    std::cout << '|' << s << std::string(pad, ' ') << "|\n";
}
